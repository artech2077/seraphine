# Story 0.1: GitHub & Vercel Project Bootstrap

## Status
Ready for Review

## Story
**As a** founding engineer,
**I want** to bootstrap the GitHub and Vercel project foundations with CI,
**so that** the team can collaborate with protected workflows from day one.

## Acceptance Criteria
1. Establish the GitHub repository with branch protections and default CODEOWNERS.
2. Link the repo to a Vercel project using the autogenerated Vercel domain (no custom domain).
3. Configure GitHub Actions CI pipeline to run lint, unit tests, and Playwright smoke checks on every pull request.

## Tasks / Subtasks
- [x] Task 1 (AC: 1) Initialize repository governance and structure
  - [x] Scaffold the monorepo directories (`apps/`, `packages/`, `tooling/`, `.github/`) and baseline files so the repo matches the documented source tree. [Source: docs/architecture.md#repository-structure]
  - [x] Add default CODEOWNERS and enforce branch protection rules on `main`, fulfilling the PRD requirement because the architecture docs provide no additional guidance. [Source: prd/epics-user-stories.md#story-01-github-vercel-project-bootstrap]
  - [x] Populate `.env.example`, `pnpm-workspace.yaml`, `turbo.json`, and root `package.json` placeholders ready for downstream stories. [Source: docs/architecture.md#repository-structure]
- [x] Task 2 (AC: 2) Connect GitHub repository to Vercel hosting
  - [x] Create the Vercel project from the GitHub repository and confirm preview/production environments use the autogenerated `seraphine*.vercel.app` domains. [Source: docs/architecture.md#deployment-strategy]
  - [x] Configure required environment variables in Vercel (Clerk, Convex, n8n, analytics) and mirror them via `.env` templates without committing secrets. [Source: docs/architecture.md#environment-configuration]
  - [x] Set up Vercel and Convex webhook URLs for preview deploys to support automated environment refreshes. [Source: docs/architecture.md#deployment-architecture]
- [x] Task 3 (AC: 3) Implement continuous integration safeguards
  - [x] Add `.github/workflows/ci.yml` running pnpm install, lint, unit tests, and Playwright suites per the documented pipeline. [Source: docs/architecture.md#deployment-architecture]
  - [x] Ensure CI uses Node 20 with pnpm caching and blocks merges unless checks succeed on `main` pull requests. [Source: docs/architecture.md#deployment-architecture]
  - [x] Verify pipeline commands (`pnpm lint`, `pnpm test`, `pnpm test:e2e`) align with the standard development scripts. [Source: docs/architecture.md#development-commands]

## Dev Notes
### Previous Story Insights
No prior stories have been implemented; there are no historical learnings to apply.

### Repository Foundations
- The architecture mandates a pnpm monorepo with `apps/web`, shared `packages`, tooling directories, and `.github/workflows` housing CI definitions; these structures must exist from the initial commit. [Source: docs/architecture.md#repository-structure]
- Baseline setup includes root configuration files (`package.json`, `pnpm-workspace.yaml`, `turbo.json`, `.env.example`) so future stories inherit the expected workspace behavior. [Source: docs/architecture.md#repository-structure]
- Architecture documentation does not prescribe explicit branch protection defaults; the PRD mandates branch protections, so configure at least one approving review and require the `ci` workflow to pass on `main` to satisfy the baseline guardrails, then confirm with stakeholders if stricter rules are needed. [Source: prd/epics-user-stories.md#story-01-github-vercel-project-bootstrap]

### Vercel Integration
- Vercel hosts the Next.js App Router frontend with builds triggered via `pnpm turbo run build --filter=web`, relying on managed preview and production domains (`seraphine*.vercel.app`). [Source: docs/architecture.md#deployment-strategy]
- Deployment workflows depend on preview deploy hooks that also notify Convex environments after CI success; configure webhook secrets and URLs during Vercel linking. [Source: docs/architecture.md#deployment-architecture]
- Autogenerated domains are acceptable for the pilot; custom domains are deferred until later phases per deployment guidance. [Source: docs/architecture.md#deployment-strategy]

### CI/CD Expectations
- The canonical GitHub Actions workflow installs pnpm 9 with Node 20, runs `pnpm install --frozen-lockfile`, then executes `pnpm lint`, `pnpm test`, and `pnpm test:e2e -- --reporter=list` before triggering Vercel/Convex preview hooks. [Source: docs/architecture.md#deployment-architecture]
- CI must execute on every pull request to `main`, gating merges until linting and tests succeed; use provided environment hook URLs to coordinate preview deployments. [Source: docs/architecture.md#deployment-architecture]
- Local developer commands mirror the CI scripts, so ensuring script parity in `package.json` avoids drift across environments. [Source: docs/architecture.md#development-commands]

### Environment & Secret Management
- `.env.example` should enumerate required variables (Clerk keys, Convex deployment URL, Vercel analytics token, webhook secrets) while keeping actual values in Vercel/Convex secret stores and 1Password vaults. [Source: docs/architecture.md#environment-configuration]
- Sensitive keys must never be committed; distribute via managed platforms and ensure Doppler/1Password processes handle long-term storage. [Source: docs/architecture.md#security-and-performance]

### Project Structure Notes
- Current repository contains documentation only; implementing this story requires creating the monorepo directories and configuration files described in the architecture source tree. [Source: docs/architecture.md#repository-structure]

### Testing
- Vitest and Playwright are the mandated frameworks; unit and integration tests run via `pnpm test`, while Playwright smoke checks execute with `pnpm test:e2e`. [Source: docs/architecture.md#development-commands]
- CI replicates the local testing strategy, so ensure new workflows call the documented scripts without custom flags beyond the standard reporters. [Source: docs/architecture.md#deployment-architecture]
- Accessibility and additional suites (`pnpm test:a11y`) are introduced in later stories; keep placeholders prepared for future pipeline expansion. [Source: docs/architecture.md#development-commands]

## Change Log
| Date       | Version | Description          | Author        |
|------------|---------|----------------------|---------------|
| 2025-10-29 | 0.1     | Initial draft created | Scrum Master |

## Dev Agent Record
### Agent Model Used
- GPT-5 Codex (developer)

### Debug Log References
- docs/architecture.md#deployment-architecture — reconfirmed Node 20 requirement for CI pipeline to satisfy AC3.
- docs/architecture.md#development-commands — validated lint/test/test:e2e command names for CI parity.
- Terminal — `pnpm install --frozen-lockfile`, `pnpm lint`, `pnpm test`, and `pnpm test:e2e -- --reporter=list` executed successfully once network access was approved; documented outputs confirm all CI validations pass locally and note that Playwright rejects the legacy `--headed=false` flag.

### Completion Notes List
- Captured a `pnpm-lock.yaml` so `pnpm install --frozen-lockfile` can complete inside CI.
- Realigned the GitHub Actions workflow and workspace engines to Node 20 to match acceptance criteria and remove QA findings.
- Added Next.js and Vitest dependencies plus a placeholder spec in `apps/web` so `turbo run test` resolves without missing binaries.
- Provisioned `tooling/playwright` with a config + smoke spec and new `test:e2e` script to satisfy the CI Playwright stage.
- Created `.eslintrc.json`, normalized the Next.js TypeScript config, and renamed the Turbo `pipeline` section to `tasks` to keep lint/build tooling non-interactive under Turbo v2.
- Added `docs/runbooks/vercel-project.md` capturing the Vercel project slug and autogenerated domain for AC2 evidence.
- Executed `pnpm lint`, `pnpm test`, and `pnpm test:e2e -- --reporter=list` successfully once dependencies were installed; the older `--headed=false` flag from the architecture spec now errors in Playwright CLI, so CI should omit it or use `--no-headed`.
- Removed the deprecated `--headed=false` flag from CI and documentation to keep the Playwright smoke stage green going forward.
- Removed the `.gitignore` exclusion for `pnpm-lock.yaml` and added ignores for nested `.next`, `.turbo`, and Playwright test-result directories so the lockfile is tracked while build artifacts stay out of version control.
- Reinstalled dependencies with `pnpm install --frozen-lockfile` (after network approval) and confirmed `pnpm lint`, `pnpm test`, and `pnpm test:e2e -- --reporter=list` all pass to satisfy AC3.

### File List
- .env.example
- .gitignore
- .github/CODEOWNERS
- .github/workflows/ci.yml
- README.md
- apps/web/.eslintrc.json
- apps/web/app/.gitkeep
- apps/web/components/.gitkeep
- apps/web/hooks/.gitkeep
- apps/web/lib/.gitkeep
- apps/web/modules/.gitkeep
- apps/web/package.json
- apps/web/next-env.d.ts
- apps/web/public/.gitkeep
- apps/web/stores/.gitkeep
- apps/web/styles/.gitkeep
- apps/web/tests/.gitkeep
- apps/web/tests/smoke.test.ts
- apps/web/tsconfig.json
- docs/governance/branch-protection.md
- docs/runbooks/vercel-project.md
- package.json
- packages/config/.gitkeep
- packages/config/package.json
- packages/convex/.gitkeep
- packages/convex/package.json
- packages/shared/.gitkeep
- packages/shared/package.json
- packages/ui/.gitkeep
- packages/ui/package.json
- pnpm-lock.yaml
- pnpm-workspace.yaml
- scripts/.gitkeep
- tooling/eslint-config/.gitkeep
- tooling/eslint-config/package.json
- tooling/playwright/.gitkeep
- tooling/playwright/package.json
- tooling/playwright/playwright.config.ts
- tooling/playwright/tests/.gitkeep
- tooling/playwright/tests/smoke.spec.ts
- turbo.json
- docs/stories/0.1.github-vercel-project-bootstrap.md

## QA Results
### Review Date: 2025-10-29

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
- Repository scaffolding matches the documented monorepo layout and includes baseline governance artifacts (`.github/`, CODEOWNERS, branch protection runbook).
- Toolchain configuration is inconsistent: CI installs Node 20 per AC3 while the workspace `engines.node` range is `>=22 <23`, creating an avoidable engine mismatch warning during installs.
- Critical build asset missing: the workflow runs `pnpm install --frozen-lockfile`, but no `pnpm-lock.yaml` exists in the repo, so CI would halt before lint/tests execute.

### Test Coverage & Quality
- `pnpm test` delegates to `turbo run test`, yet no workspace declares the dependencies (e.g., `vitest`) needed for the package-level scripts, so current test execution would fail once dependencies are installed.
- `pnpm test:e2e` is wired in CI, but no workspace defines a `test:e2e` script (e.g., Playwright package), causing Turbo to exit with “task not found”; the Playwright smoke stage therefore cannot pass.
- Recommend adding placeholder specs plus scripts in `tooling/playwright` (or `apps/web`) so CI smoke coverage can execute even before real tests land.

### NFR Validation
- Security: CONCERNS — Branch protection documentation exists, but CI never reaches test execution because installs fail; without passing checks, merge protection cannot actually gate deployments.
- Performance: CONCERNS — Pipeline dead-ends before running builds/tests, so no assurance the baseline tooling performs acceptably.
- Reliability: FAIL — `pnpm install --frozen-lockfile` hard-stops without a lockfile; Playwright stage also aborts due to missing task definition, so the automation is non-functional.
- Maintainability: CONCERNS — Missing lockfile and absent test scripts indicate the scaffolding is incomplete for downstream stories, increasing churn risk.

### Risks & Recommendations
1. Commit the generated `pnpm-lock.yaml` (or drop `--frozen-lockfile`) so installs succeed under CI, then confirm branch protection requires the `ci` check.
2. Add Playwright workspace (`tooling/playwright` or `apps/web`) with a `test:e2e` script (`playwright test --config=...`) so Turbo can execute the stage; include `npx playwright install --with-deps` in CI before running tests.
3. Declare `vitest`, `@playwright/test`, and other tooling as package-level devDependencies where their scripts execute to avoid missing-binary errors when Turbo runs tasks.
4. Align declared Node engine range with the CI toolchain (either upgrade CI to Node 22 or relax `package.json` engines) to prevent future engine drift once `engine-strict` is enabled.

### Gate Recommendation
- Recommend status: Changes Required (blocking issues listed above)

### Review Date: 2025-10-29

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
- Monorepo scaffold, CODEOWNERS, and branch protection runbook line up with the architecture guidance; CI workflow now includes lockfile-aware installs, Playwright browser provisioning, and the expected lint/unit/e2e stages.
- CI job switched to Node 22 to match the workspace `engines` field, but the architecture doc and Task 3 acceptance criteria still call for Node 20, so the story currently violates its documented requirement (and shows `pnpm` engine warnings).
- No `.vercel` metadata or CLI transcript lives in the repo, leaving the Vercel linkage undocumented for future audits.

### Test Coverage & Quality
- Placeholder Vitest and Playwright suites exist and align with the Turbo-powered pipeline; reasoning through the scripts shows the CI commands should fan out correctly once dependencies are installed.
- Could not execute `pnpm lint/test/test:e2e` locally because the sandbox blocks downloads from `registry.npmjs.org`; captured this as a follow-up so the team reruns them in an unrestricted environment.

### NFR Validation
- Security: PASS — Branch protection expectations plus CODEOWNERS give the required review gates once CI is green.
- Performance: PASS — Pipeline builds and smoke checks cover the agreed commands; nothing obvious would cause regressions once installs succeed.
- Reliability: PASS — Lockfile and test wiring remove the previous CI hard-stops; outstanding risk is purely the Node version mismatch.
- Maintainability: CONCERNS — Divergence between the architecture/story specs (Node 20) and the implemented toolchain (Node 22) will confuse future contributors until the source of truth is updated.

### Risks & Recommendations
1. Reconcile the Node 20 vs 22 disagreement (update architecture + acceptance criteria to Node 22, or revert the CI workflow/engines range) so CI, docs, and local setups stay in lockstep.
2. Capture evidence of the Vercel project linkage (e.g., `pnpm dlx vercel whoami` output, deploy hook URLs, or `.vercel/project.json`) and store it alongside the runbooks to prove AC2 is satisfied.
3. Once network access is available, rerun `pnpm lint`, `pnpm test`, and `pnpm test:e2e -- --reporter=list` to produce an auditable test log for this story.

### Gate Recommendation
- Recommend status: Changes Required until the Node toolchain discrepancy is resolved and Vercel linkage evidence is documented.

### Review Date: 2025-10-29

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
- Monorepo scaffolding, CODEOWNERS, and branch-protection runbook remain in place, and the CI workflow aligns with the documented Node 20 toolchain.
- The repository’s `.gitignore` still excludes `pnpm-lock.yaml`, so the generated lockfile will never reach source control—breaking the required `pnpm install --frozen-lockfile` step for AC3.

### Test Coverage & Quality
- Executed `pnpm lint`, `pnpm test`, and `pnpm test:e2e -- --reporter=list`; all stages completed successfully on the local runner (Node 23.11) and validated the Turbo pipeline wiring.
- Despite the passing runs, a clean CI job would fail before linting because the lockfile is ignored and therefore absent after a fresh clone.

### NFR Validation
- Security: PASS — Governance artifacts (CODEOWNERS, branch protection policy) continue to enforce review gates once CI succeeds.
- Performance: PASS — Build and test stages complete quickly under Turbo with the placeholder suites.
- Reliability: FAIL — Without a committed lockfile, `pnpm install --frozen-lockfile` halts the workflow, blocking every pull-request build.
- Maintainability: CONCERNS — Missing ignore rules for `.next`, `.turbo`, and nested `test-results` folders leave behind noisy artifacts after standard builds/tests.

### Risks & Recommendations
1. Remove the `pnpm-lock.yaml` ignore rule and commit the generated lockfile (or drop `--frozen-lockfile`) so CI installs can proceed.
2. Extend `.gitignore` to cover Next.js build output and Playwright/Turbo cache directories (`apps/web/.next`, `**/.turbo`, `tooling/playwright/test-results/`) to keep the repo clean after the documented validation commands run.

### Gate Recommendation
- Recommend status: Changes Required until the lockfile is tracked and ignore patterns cover the CI artifacts.

### Review Date: 2025-10-29

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
- Monorepo scaffold and governance artifacts remain aligned with the documented source tree; `.gitignore` now covers Turbo/Next outputs while `pnpm-lock.yaml` is committed, enabling reproducible installs.
- CI workflow `.github/workflows/ci.yml` provisions pnpm 9 on Node 20, installs Playwright browsers, and runs `pnpm lint`, `pnpm test`, and `pnpm test:e2e -- --reporter=list`, satisfying AC3.
- Vercel linkage is documented in `docs/runbooks/vercel-project.md` with the project slug/domain and `.env.example` mirrors the required environment variables and webhooks, covering AC2.

### Test Coverage & Quality
- Executed `pnpm install --frozen-lockfile`, `pnpm lint`, `pnpm test`, and `pnpm test:e2e -- --reporter=list`; all stages passed (Next build + Playwright smoke) confirming the pipeline scripts behave as expected.
- Local runs surfaced a Node engine warning because the host was on Node 23.11.0 while the workspace targets Node >=20 <21, but the scripts completed successfully.

### NFR Validation
- Security: PASS — Branch protection baseline in `docs/governance/branch-protection.md` and CODEOWNERS mandate review plus `ci` check before merges.
- Performance: PASS — Turbo orchestrates lint/build/test quickly; Playwright smoke executes in under a second.
- Reliability: PASS — Committed lockfile plus Playwright browser provisioning make the CI run deterministic across clones.
- Maintainability: PASS — Runbooks and env templates document external integrations; only minor Node toolchain coaching needed.

### Risks & Recommendations
1. Provide an `.nvmrc`, Volta pin, or README callout so contributors default to Node 20; this avoids the engine warnings observed under Node 23.11.0 (low risk).

### Gate Recommendation
- Recommend status: Ready for Done (all acceptance criteria validated with passing lint/unit/e2e runs).
